---
title: 流量反作弊模型策略的工作心得
categories: 开发随笔
tags: [建模]
description: 
comments: false
author: Tang Qi
sidebar:
  nav: docs-cn
aside:
  toc: true
layout: post
---

## 异常流量的定义

​	广告投放反作弊用于检测异常用户行为，优化广告投放的精准度和效果。为实现拉新和促活的目的，广告投放主要包括RTA直投、DSP竞价、自媒体KOL/KOC、晚会等方式。除了直投一口价、对达人笔记的流量计价、商店(出自然量、活动量)排序计价外，其他基本上按归因来源对其请求后带来的曝光、点击、安装和激活动作进行计价。不同的按量计价方式会产生不同的作弊手段。由于广告竞价、曝光对于用户而言是被动的，在曝光上的异常往往是平台质量不高或回传数据不可靠。在点击、激活阶段的黑产主要依赖自动化脚本刷量、肉鸡。而网赚类的平台、羊毛党(真人用户)如无其他异常，不被定义为作弊性质，仅属于低GMV投放。



## 批处理的全量黑名单系统 ，对异常请求进行实时拦截

1. 生成打标名单: Hive离线定时分析用户信息/行为数据，生成打标名单。将名单导出成高吞吐量低延迟的kafka消息 (hive查询太慢了)；
2. 规则引擎监听并消费消息：将打标名单加载到Redis缓存中；
3. 规则引擎手动配置线上规则：白名单、黑名单、实验组、对照组、优先级
4. 实时风控：对媒体传回的请求数据流进行落标，通过匹配规则引擎来判断是否拦截或放行到实时模型与竞价阶段。



## 规则引擎的迭代 

​	规则引擎在数年间经过了多次迭代，从单纯的拦截名单，到新增白名单、灰度、实验组对照组和优先级的考量。规则引擎的设计需要考虑： 1. 性能：毫秒级的响应；2. 逻辑上的优先级；3.策略模型全量准确性的评估 (组内成员的考核需求)  

​	在hive表生成名单后，会在规则引擎配置规则进入白名单（商店、点位、资源位、媒体送的免费量、GMV高的渠道等）、拦截实验组(灰度)、实验对照组。请求如果已经被优先级高的规则拦截了，是否还有必要过后续规则呢？有的。原因： 

	1. 判断每个规则的查准率是否达标。避免因优先级高的策略先误伤了而高估后续策略 (利于日常持续的策略评估)； 
	1. 判断每个规则的查全率是否充分。避免了因优先级高的策略先拦截了而低估后续策略。对于非常准确、有信心的拦截策略/模型，优先级提前，享受了更多的拦截量(业绩)。但上线时再准确的模型策略也总有效果衰减或者黑产转而改变作弊手段的一天。当策略模型效果衰减的时候，会首先误伤正常用户。此时，有充分的历史数据证明靠后优先级的策略，能否挑起大梁。

​	但根据规则优先级依次过一遍引擎，对请求的响应可能会经过数百个风控的规则，很容易超时而走直接竞价兜底，避开风控环节。

​	最近想到一个或许折中的办法：在过规则引擎时，只要被高优先级的规则拦截了，实时就无需再过剩下的规则了。但调用异步资源，离线再整体过一遍规则引擎，对每条请求数据进行规则打标。毕竟请求数据本身也会被保存数周时间。



## 异常行为捕捉

​	类似于金融中的可疑交易监控甄别，投放反作弊也针对各类异常的行为逻辑、聚集性、相似性、频率、软硬件信息、网络环境等特征加工以拦截。有些异常行为可能非常基础，不具备技术性，但却有非常大的量，能有很大的收益。这种行为可能复杂的非线性模型会忽视，但却能从很基础的数据抽样中观察出来。异常请求的发现，不能脱离对数据的基础、直观的观察。

​	但这样根据黑名单的防卫会有些亡羊补牢，实时性较低。基于策略中的特征，通过传统机器学习模型，实时/半实时训练预测，可以有效降低误伤，避免预算大量流失。模型输出的特征，反哺策略，再进一步优化模型。但需要强调模型结果以外的可解释性，确定异常的逻辑，否则容易左脚蹬右脚，而误伤拦截对正常或低GMV用户的投放。

​	反作弊和大额可疑交易一样，黑产常是团伙性质的，但广告黑产的手段更隐蔽。刷机、改机、模拟器、自动化脚本层出不穷。此外，媒体渠道回传的数据质量，投放平台的质量、广告主的归因判别逻辑，都会影响到黑产的甄别。在算法上，作弊团伙的甄别和大额可疑交易团伙的甄别一致，常用的社区类、图论、相似性算法表现佳。但不同的是，可疑交易的交易方和对手方一定是强相关的，但在connection matrix构建时，并不总有非常有力的强相关共性作为异常聚集的判别，因此更容易产生误伤，需要单产或关联条件之外的异常行为来辅助判定。对于社区中，关联关系亲密度，异常个体占比数量，影响团伙的最终定义。

​	此外，对比传统模型，热门的 LLMs 能结合多个数据源构建更复杂的反作弊模型，更全面地识别异常行为，也可以不断改进和优化反作弊算法，提高泛化能力、鲁棒性和查全查准。但由于成本实现，目前更常用于商货品详情，客服和业务场景中。

​	针对达人的投放，是否异常主要凭借关键词后续效果。这部分目前媒体回传的可用于异常甄别的信息比较有限。



## 实时模型预测，对异常请求进行实时拦截

1. 实时检测与响应算法：

   + 在线学习算法，如Online Gradient Descent，在数据到达时即时更新模型参数；

   + 通过流处理框架实现模型的在线更新和持续学习，使用TensorFlow Extended (TFX)或类似的工具链支持模型的实时训练；

2. 持续学习与模型更新：

   - 增量学习算法：如Hoeffding Tree、Online Random Forest等，能够在新数据到达时逐步更新模型，无需重新训练整个模型。
   - 强化学习：应用强化学习算法，如Q-Learning或DQN，通过不断地与环境交互来优化反作弊策略。
   - AutoML：使用自动化机器学习（AutoML）工具，如Google AutoML，自动选择和优化模型参数，提高模型的准确性和响应速度。
     













