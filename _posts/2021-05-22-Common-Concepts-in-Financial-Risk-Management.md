---
title: 金融风控模型经验总结
categories: 开发随笔
tags: 
description: 
comments: false
author: Tang Qi
sidebar:
  nav: docs-cn
aside:
  toc: true
layout: post
---



银行风控领域主要有：信用评分(贷前A卡), 风险预警(贷中B卡),违约预测与催收(C卡),反欺诈,大额可疑交易(AML)，营销模型等。在之前的工作中，我主要负责A卡、B卡、AML、企业存活预测(贷中)、上下游产业风险传导等。



## 业务经验

1. 对公B卡的计算涉及维度：综合风险预警的B卡，涉及到历史履约情况、经营财务(着重在：应收账款与票据、固定资产、主营业务利润率、净利润率)、及企业自身属性 (行业分类、企业规模、所属城市等)。由于涉及不同维度，经常有维度数据缺失的问题，应当在业务经验基础上进行推荐，置0、null，none或删除。
2. 在业务经验中，所属城市常对于决策有较大的影响。由于有些小型城市历史的对公(非国企)数据并不充裕，即使是分类型变量也需要进行分箱合并。类似的还有新财务指标中的企业规模(大、中(含新模型中型))， 行业(大类)，经济成分等。
3. 所属行业、企业规模对模型结果的影响也很大，因此常按照有贷户所属行业大类，企业规模进行分箱，并对企业总数目大于1000的分箱，单独建立预测模型。
4. A卡、B卡看重可解释性，需要对数值型特征提供箱型图，对于所有特征计算出每个数值特征所属分箱 (卡方、等频、等宽) 的WOE以及IV值，以评估其对目标变量（如违约）的区分能力。
5. AB卡一般使用线性模型、或基础树模型。A卡最常用评分卡，B卡最常用逻辑回归。在基础模型之外，random_forest, xgboost 的得分也用作辅助建议。
6. 对公风控上，资产负债与利润表中：营业总收入、净利润、净利润率、净利润增长率、资产净利润率、总资产周转率、所有者权益合计、资产总计、负债总计常属于需要重点关注的部分。现金流量表中：期末现金及现金等价物余额、支付的其他与经营活动有关的现金、销售商品/提供劳务收到的现金、偿还债务支付的现金、支付给职工以及为职工支付的现金、负债合计、购买商品/接受劳务支付的现金 常是需要重点关注部分。
7. 理论上，现金流量表在库中不应该包含空记录。期末现金及现金等价物余额不应该为非正数，其他的数据不应该为负数。但在实际工作中，遇到了非常多企业维护的值是负数。看数据应该是维护数据不规范问题，需要规范化。
8. 产业链上的舆情风险，常有：美国制裁、高管离职、企业破产等。上游的风险，会传导到下游的企业, 典型的有半导体行业。在传导过程中，也会有风险的衰减。越靠近源头风险的企业，收到的影响越大。对于这部分风险预警，最主要的有风险类型、风险路径、链路抗风险能力的指标需要考量。在最终的风险汇总中，也需要适合的权重系数进行叠加。
9. 大额可疑交易可疑交易的特征在地区性、活跃月份、客户画像等方面会表现出异质性。长三角地区，可疑交易来源重头在金融诈骗、非法吸收公众存款、非法跨境转移资金；中部、北部地区，重头之一在非法经营（地下钱庄、非法买卖外汇、POS机套现、其他套现）以及组织经营赌博或为其转移资金；南部地区，需要关注组织领导传销活动、诈骗（如电信诈骗）。在交易对手上也可提现出差异。在对公业务中进行可疑交易的成本较高，在对公的异常交易甄别，除了关注交易本身外，更需要考虑企业的自身信息，比如经营模式、注册资金、运营年限和账户数量等。
10. 在大额可以交易的数据清洗上，需要留意人行关于重复上报的政策，以及延迟上报的案例，不要误入正常标记。



## 数据分析与模型经验

1. pandas_profiling 在特征工程中很方便用。

2. 连续型特征卡方分箱：
   基于统计的特征离散化方法，合并具有相似类分布的相邻区间，将连续型数据离散化，减少变量的取值数。与等频分箱、等距分箱相比，决策树（如卡方分箱）能更好地反映数据分布的实际情况。以往经验：

   ```python
                    max_depth=None,  # 决策树的深度
                    max_leaf_nodes=4,  # 决策树的子节点数
                    min_samples_leaf=0.05,  # 分节点最小划分比例
                    base_score=600,  # 基础分
                    increase_score=20,  # 增加分（概率增加一倍所增加的分数）
                    min_iv=0.01,  # 特征筛选（选取IV值大于0.01的值）
                    max_corr=0.7,  # 特征筛选（选取相关性小于0.7的值）
                    C=0.01,  # 特征筛选（L2正则化系数）
                    penalty='l2',  # 特征筛选（L2正则化）
                    round_num=2  # 所有变量保留两位有效数
   ```

3. 对分箱好的连续性变量与其他处理好的(异常值处理、归并等)离散型变量进行WOE和IV值的计算、与one-hot处理。WOE 是一种将分类变量转化为有线性关系的数值变量的方法，有效捕捉变量与目标变量之间的非线性关系，通过计算各分类的“证据权重”来衡量该分类对目标变量的影响，使得模型更易解释和分析，使得模型的结果更加透明。IV 通过累积各分箱的 WOE 值与对应的分布差值的乘积来衡量整个变量的信息量，值越大表示变量的区分能力越强。
   WOE=ln(Good Distribution/Bad Distribution)
   IV=∑(Good Distribution−Bad Distribution)×WOE

4. 评分卡计算。在实际操作中，Factor 和 Offset 会根据模型的具体需求进行调整。例如，Factor 可能设定为 20，Offset 可能设定为 400。这些值会根据模型输出的分数范围和业务需求进行校准。通常，评分卡的设计目标是使某个特定的评分（如 600 分）对应于某个特定的违约概率（如 1%）。要训练出最优的Offset和Factor设置，一般用网格搜索或者交叉验证，找到使模型在验证集上表现最优的参数组合。评估指标是AUC、KS统计量等，用于衡量模型的区分能力和稳定性。
   

5. 在金融风控模型中，特别是注重可解释性的模型，多个单模型各自建模然后回归得到的结果，比特征合并到一起做一个大的模型效果好。也就是集成模型的效果，通常比汇总特征做单个模型效果好，因为集成模型可以有效地综合多个模型的优势，减少偏差和方差，提高整体的预测能力。

   1. 减少过拟合：即使是线性模型，也可能因为样本数量少，缺少正则，或者无关特征多的因素，产生过拟合。多个单模型独立训练时，各自对不同的数据特征和模式进行拟合，可以避免单个模型对训练数据的过拟合问题。
   2. 多样性优势：不同的模型可能擅长捕捉数据中的不同模式和特征，集成多个模型可以综合这些不同的视角，从而提高整体的预测性能。比如在AML模型中，既需要精确找到历史数据中的pattern，也需要通过无监督模型来预防新的黑产手段出现。因此，集成两种不同的算法， 可以兼顾当下查准与未来的查全。
   3. 更好的特征利用：各自建模的单模型可以针对不同特征进行优化和调整，而大模型可能难以处理所有特征之间的复杂关系，从而影响模型效果。

   在数据量非常充分，非线性程度高，不要求可解释性，线上存在多角度的补充模型，半实时训练的情况下，统一的大模型可能更适合。

6. 在企业经营风险的建模过程中，存在大量“不具有有效现金流记录有贷企业客户”，对于这部分客户，通过其他 “具有有效现金流记录有贷企业客户” ，建立多元回归模型，凭借必须公布的资产负债表、利润表对无现金流有贷户进行预测。在多元回归模型中，利用皮尔森相关性分析排除其中高度线性相关的特征。

7. 对AB卡不同，AML的重点是查准查全，有监督与无监督并用的集成模型效果最好。

8. 对于团伙的评估，大额交易的交易方和交易对手天然具有强关联性，利用这些信息构建无向图，并应用社区发现类算法，其结果不仅表现出色而且易于解释。其中，Louvain、PageRank 算法表现最好。针对团伙挖掘，图谱性质的模型在可解释性和查全率上优于传统的机器学习模型。



![01](https://raw.githubusercontent.com/iqgnat/iqgnat.github.io/master/assets/images/2021-05-22-Common-Concepts-in-Financial-Risk-Management/01.png)

